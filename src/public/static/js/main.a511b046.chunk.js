(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{43:function(e,t,n){e.exports=n(85)},78:function(e,t,n){},85:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(38),s=n.n(c),o=n(12),i=n(2),u=n.n(i),l=n(9),m=n(3),d=n(4),p=n(6),h=n(5),f=n(7),b=n(23),O=n(18),v=function(e){function t(){return Object(m.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement("footer",{className:"container"},r.a.createElement("p",{className:"text-muted"},r.a.createElement("small",null,"\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043e ",r.a.createElement("b",null,"aksyline"))))}}]),t}(r.a.Component),E=function(e){function t(){return Object(m.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"flex-shrink-0"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"mt-5"},this.props.children,r.a.createElement(v,null))))}}]),t}(r.a.Component),g=n(1),j=n(40),k=n.n(j),y=n(41),S=n.n(y),N=(n(56),function(e){function t(){return Object(m.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"card",style:{whiteSpace:"pre-line"}},r.a.createElement("div",{className:"card-body"},this.props.data.text),r.a.createElement("div",{className:"card-footer text-muted"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-sm"},r.a.createElement("small",null,this.props.data.author)),r.a.createElement("div",{className:"col-sm text-right"},r.a.createElement("small",null,r.a.createElement(S.a,{format:"HH:MM DD.MM.Y",date:this.props.data.publishedAt}))))))}}]),t}(r.a.Component)),w=function(e){function t(){return Object(m.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"text-center"},r.a.createElement("div",{className:"spinner-grow text-pripary"},r.a.createElement("span",{className:"sr-only"},"Loading")))}}]),t}(r.a.Component),C=n(17),T=n.n(C),x=n(19),A=n(24),F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(console.log("Action with anecdotes type: ".concat(t.type)),t.type){case"ADD_ANECDOTES":return[].concat(Object(A.a)(e),Object(A.a)(t.anecdotes));case"ADD_ANECDOTE":return[t.anecdote].concat(Object(A.a)(e));case"SET_ANECDOTES":return Object(A.a)(t.anecdotes);default:return e}},D={count:0},I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ANECDOTES_COUNT":return Object.assign({},e,{count:t.count});default:return e}},_={tokenId:null,accessToken:null,refreshToken:null},L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TOKEN_ID":return Object.assign({},e,{tokenId:t.tokenId});case"SET_ACCESS_TOKEN":return Object.assign({},e,{accessToken:t.accessToken});case"SET_REFRESH_TOKEN":return Object.assign({},e,{refreshToken:t.refreshToken});case"SET_CREDENTIALS":return console.log("set credentials",t.credentials),Object.assign({},e,t.credentials);default:return e}},P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"PUBLISHED";switch((arguments.length>1?arguments[1]:void 0).type){case"SET_FILTER_PUBLISHED":return"PUBLISHED";case'SET_FILTER"FOR_PUBLICATION':return"FOR_PUBLICATION";default:return e}},M=Object(x.b)({anecdotes:F,statistic:I,auth:L,filter:P}),U=Object(x.c)(M),H=function(e){return{type:"ADD_ANECDOTES",anecdotes:e}},B=function(e){return{type:"SET_CREDENTIALS",credentials:e}},R=function(){var e=Object(l.a)(u.a.mark(function e(t,n,a){var r,c,s,o,i;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=U.getState().auth.accessToken,e.prev=1,console.log("try request to ".concat(n," with token ").concat(r)),e.next=5,T.a[t](n,a,{headers:{Token:r}});case 5:return c=e.sent,e.abrupt("return",c);case 9:if(e.prev=9,e.t0=e.catch(1),s=U.getState().auth,console.log("old credentials: ",s),"TokenExpired"!==e.t0.response.data.message){e.next=24;break}return e.next=16,T.a.post("".concat("/","refresh"),s);case 16:return o=e.sent.data,console.log("new data: ",o),i={tokenId:s.tokenId,accessToken:o.accessToken,refreshToken:o.refreshToken},U.dispatch(B(i)),localStorage.setItem("credentials",JSON.stringify(i)),e.abrupt("return",T.a[t](n,a,{headers:{token:o.accessToken}}));case 24:throw e.t0;case 25:case"end":return e.stop()}},e,null,[[1,9]])}));return function(t,n,a){return e.apply(this,arguments)}}(),J={getAnecdotes:function(){var e=Object(l.a)(u.a.mark(function e(){var t,n,a=arguments;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:10,n=a.length>1&&void 0!==a[1]?a[1]:Date.now(),console.log("pagesize: ".concat(t,", afterDate: ").concat(n)),e.next=5,T.a.get("".concat("/","anecdotes?size=").concat(t,"&before=").concat(new Date(n).getTime()));case 5:return e.abrupt("return",e.sent.data);case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),getAnecotesCount:function(){var e=Object(l.a)(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.a.get("".concat("/","anecdotes/count"));case 2:return e.abrupt("return",e.sent.data);case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),createAnecdote:function(){var e=Object(l.a)(u.a.mark(function e(t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(U.getState().auth.accessToken){e.next=3;break}throw new Error("Authorization is needed");case 3:return e.next=5,R("post","".concat("/","anecdotes/create"),t);case 5:return e.abrupt("return",e.sent.data);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),createToken:function(){var e=Object(l.a)(u.a.mark(function e(t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.a.post("".concat("/","signin"),t);case 2:return e.abrupt("return",e.sent.data);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),register:function(){var e=Object(l.a)(u.a.mark(function e(t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.a.post("".concat("/","signup"),t);case 2:return e.abrupt("return",e.sent.data);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},z=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(h.a)(t).call(this))).state={hasMore:!0},e.loadMore=e.loadMore.bind(Object(g.a)(Object(g.a)(e))),e}return Object(f.a)(t,e),Object(d.a)(t,[{key:"loadMore",value:function(){var e=Object(l.a)(u.a.mark(function e(){var t,n;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.props.anecdotes.length&&(t=this.props.anecdotes[this.props.anecdotes.length-1].createdAt),e.next=3,J.getAnecdotes(void 0,t);case 3:n=e.sent,this.props.addAnecdotes(n.anecdotes),this.state.hasMore=n.anecdotes.length!==n.count;case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props.anecdotes.map(function(e){return r.a.createElement("li",{key:e._id,className:"p-2 m-2"},r.a.createElement(N,{data:e}))});return r.a.createElement(k.a,{hasMore:this.state.hasMore,loader:r.a.createElement(w,{key:0}),loadMore:this.loadMore},r.a.createElement("ul",{className:"list-unstyled"},e))}}]),t}(r.a.Component),K=Object(o.b)(function(e){return{anecdotes:e.anecdotes}},function(e){return{addAnecdotes:function(t){return e(H(t))}}})(z),q="\n    \u042d\u0442\u043e \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u0441 \u0430\u0432\u0442\u043e\u0440\u0441\u043a\u043e\u0439 \u043f\u043e\u0434\u0431\u043e\u0440\u043a\u043e\u0439 \u0430\u043d\u0435\u043a\u0434\u043e\u0442\u043e\u0432. \u042d\u0442\u0438 \u0430\u043d\u0435\u043a\u0434\u043e\u0442\u044b \u0444\u0438\u0433\u0443\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438 \u0441 \u0440\u0430\u0437\u0433\u043e\u0432\u043e\u0440\u0430\u0445, \n    \u0431\u044b\u043b\u0438 \u0443\u0441\u043b\u044b\u0448\u0430\u043d\u044b \u0432 \u0421\u041c\u0418, \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u044b \u0432 \u0440\u0430\u0437\u043d\u044b\u0445 \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u0445 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430\u0445 \u0432 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u0435 \u0438\u043b\u0438 \u043f\u043e\u0447\u0435\u0440\u043f\u043d\u0443\u0442\u044b \u0438\u0437 \n    \u044e\u043c\u043e\u0440\u0438\u0441\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u043a\u043d\u0438\u0433. \u041f\u043e \u0431\u043e\u043b\u044c\u0448\u043e\u043c\u0443 \u0441\u0447\u0451\u0442\u0443, \u0441\u0430\u0439\u0442 \u043d\u043e\u0441\u0438\u0442 \u0441\u043a\u043e\u0440\u0435\u0435 \u043b\u0438\u0447\u043d\u044b\u0439 \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440, \u043e\u0442\u0440\u0430\u0436\u0430\u044f \u0432\u043a\u0443\u0441\u044b \n    \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0430. \u041e\u0434\u043d\u0430\u043a\u043e \u044f \u0431\u0443\u0434\u0443 \u0440\u0430\u0434, \u0435\u0441\u043b\u0438 \u0441\u043e\u0431\u0440\u0430\u043d\u043d\u044b\u0439 \u0437\u0434\u0435\u0441\u044c \u0444\u043e\u043b\u044c\u043a\u043b\u043e\u0440 \u0432\u0430\u043c \u043f\u043e\u043d\u0440\u0430\u0432\u0438\u0442\u0441\u044f.\n  ",W=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(h.a)(t).call(this))).goToLoginPage=e.goToLoginPage.bind(Object(g.a)(Object(g.a)(e))),e}return Object(f.a)(t,e),Object(d.a)(t,[{key:"goToLoginPage",value:function(e){e.preventDefault(),this.props.history.push("/login")}},{key:"render",value:function(){return r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"my-2"},r.a.createElement("p",null,q),r.a.createElement("p",null,"\u0412\u0441\u0435\u0433\u043e \u043d\u0430 \u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u043e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u043d\u043e ",r.a.createElement("b",null,this.props.anecdotes_count)," \u0430\u043d\u0435\u043a\u0434\u043e\u0442\u043e\u0432.")))}},{key:"componentDidMount",value:function(){var e=Object(l.a)(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.props,e.next=3,J.getAnecotesCount();case 3:e.t1=e.sent,e.t0.setAnecdotesCount.call(e.t0,e.t1);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),t}(r.a.Component),Y=Object(o.b)(function(e){return{anecdotes_count:e.statistic.count}},function(e){return{setAnecdotesCount:function(t){return e(function(e){return{type:"SET_ANECDOTES_COUNT",count:e}}(t))}}})(W),G=n(20),Q=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(h.a)(t).call(this))).state={author:"admin",text:"",status:"FOR_PUBLICATION"},e.onFieldChange=e.onFieldChange.bind(Object(g.a)(Object(g.a)(e))),e.handleSubmit=e.handleSubmit.bind(Object(g.a)(Object(g.a)(e))),e}return Object(f.a)(t,e),Object(d.a)(t,[{key:"onFieldChange",value:function(e){this.setState(Object(G.a)({},e.target.name,e.target.value))}},{key:"handleSubmit",value:function(){var e=Object(l.a)(u.a.mark(function e(t){var n;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,J.createAnecdote(this.state);case 3:n=e.sent,"PUBLISHED"===this.state.status&&this.props.addAnecdote(n.anecdote),this.props.history.push("/");case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement("form",null,r.a.createElement("p",{className:"text-center",style:{fontSize:"30px"}},"Create an anecdote"),r.a.createElement("a",{href:"/#/anecdotes/unpublished"},"Unpublished anecdotes"),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"authorAnec"},"Author"),r.a.createElement("input",{onChange:this.onFieldChange,value:this.state.author,type:"text",name:"author",className:"form-control",id:"authorAnec"})),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"statusAnec"},"Author"),r.a.createElement("select",{onChange:this.onFieldChange,value:this.state.status,name:"status",className:"form-control",id:"statusAnec"},r.a.createElement("option",{value:"FOR_PUBLICATION"},"\u041e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u0437\u0436\u0435"),r.a.createElement("option",{value:"PUBLISHED"},"\u041e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c \u0441\u0435\u0439\u0447\u0430\u0441"))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"textAnec"},"Anecdote's text"),r.a.createElement("textarea",{name:"text",value:this.state.text,onChange:this.onFieldChange,className:"form-control",id:"textAnec",rows:"4"})),r.a.createElement("div",{className:"form-group"},r.a.createElement("button",{onClick:this.handleSubmit,className:"btn btn-primary"},"Create")))}}]),t}(r.a.Component),V=Object(o.b)(null,function(e){return{addAnecdote:function(t){return e(function(e){return{type:"ADD_ANECDOTE",anecdote:e}}(t))}}})(Q),X=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(h.a)(t).call(this))).state={username:"",password:""},e.onFieldChange=e.onFieldChange.bind(Object(g.a)(Object(g.a)(e))),e.onFormSubmit=e.onFormSubmit.bind(Object(g.a)(Object(g.a)(e))),e}return Object(f.a)(t,e),Object(d.a)(t,[{key:"onFieldChange",value:function(e){this.setState(Object(G.a)({},e.target.name,e.target.value))}},{key:"onFormSubmit",value:function(e){e.preventDefault(),console.log("signin"),this.props.submitHandler(this.state.username,this.state.password)}},{key:"render",value:function(){return r.a.createElement("form",{onSubmit:this.onFormSubmit,method:"POST"},r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",className:"form-control",placeholder:"Username",name:"username",onChange:this.onFieldChange,value:this.state.username})),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"password",name:"password",className:"form-control",placeholder:"Password",onChange:this.onFieldChange,value:this.state.password})),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"submit",className:"btnSubmit",value:"Sign in"})))}}]),t}(r.a.Component),Z=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(h.a)(t).call(this))).state={username:"",password:""},e.onFieldChange=e.onFieldChange.bind(Object(g.a)(Object(g.a)(e))),e.onFormSubmit=e.onFormSubmit.bind(Object(g.a)(Object(g.a)(e))),e}return Object(f.a)(t,e),Object(d.a)(t,[{key:"onFieldChange",value:function(e){this.setState(Object(G.a)({},e.target.name,e.target.value))}},{key:"onFormSubmit",value:function(e){e.preventDefault(),console.log("signup"),this.props.submitHandler(this.state.username,this.state.password)}},{key:"render",value:function(){return r.a.createElement("form",{onSubmit:this.onFormSubmit,method:"POST"},r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",className:"form-control",placeholder:"Username",name:"username",onChange:this.onFieldChange,value:this.state.username})),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"password",name:"password",className:"form-control",placeholder:"Password",onChange:this.onFieldChange,value:this.state.password})),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"submit",className:"btnSubmit",value:"Sign in"})))}}]),t}(r.a.Component),$=(n(78),function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(h.a)(t).call(this))).onSignin=e.onSignin.bind(Object(g.a)(Object(g.a)(e))),e.onSignup=e.onSignup.bind(Object(g.a)(Object(g.a)(e))),e}return Object(f.a)(t,e),Object(d.a)(t,[{key:"onSignin",value:function(){var e=Object(l.a)(u.a.mark(function e(t,n){var a,r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Sign in with ".concat(t," and password")),e.next=3,J.createToken({username:t,password:n});case 3:a=e.sent,r={tokenId:a.tokenId,accessToken:a.accessToken,refreshToken:a.refreshToken},this.props.setCredentials(r),localStorage.setItem("credentials",JSON.stringify(r)),console.log(a);case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onSignup",value:function(){var e=Object(l.a)(u.a.mark(function e(t,n){var a,r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Sign up with ".concat(t," and password")),e.next=3,J.register({username:t,password:n});case 3:a=e.sent,r={tokenId:a.tokenId,accessToken:a.accessToken,refreshToken:a.refreshToken},this.props.setCredentials(r),localStorage.setItem("credentials",JSON.stringify(r)),console.log(a);case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row my-3"},r.a.createElement("div",{className:"col-md-6 login-form-1"},r.a.createElement("h3",null,"Sign In"),r.a.createElement(X,{submitHandler:this.onSignin})),r.a.createElement("div",{className:"col-md-6 login-form-2"},r.a.createElement("h3",null,"Sign Up"),r.a.createElement(Z,{submitHandler:this.onSignup}))))}}]),t}(r.a.Component)),ee=Object(o.b)(null,function(e){return{setCredentials:function(t){return e(B(t))}}})($),te=function(e){function t(){return Object(m.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e;return e="/"===this.props.location.pathname?r.a.createElement(b.b,{to:"/about"},"\u041e \u043f\u0440\u043e\u0435\u043a\u0442\u0435"):r.a.createElement(b.b,{to:"/"},"\u041b\u0435\u043d\u0442\u0430"),r.a.createElement("ul",{className:"nav justify-content-center"},r.a.createElement("li",{className:"nav-item px-2"},e))}}]),t}(r.a.Component),ne=Object(O.d)(function(e){return r.a.createElement(te,e)}),ae=function(e){function t(){return Object(m.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement(b.a,null,r.a.createElement(E,null,r.a.createElement("div",{className:"text-center m-3"},r.a.createElement("h1",null,"\u041b\u0443\u0447\u0448\u0438\u0435 \u0430\u043d\u0435\u043a\u0434\u043e\u0442\u044b")),r.a.createElement("div",{className:"container"},r.a.createElement(ne,null)),r.a.createElement(O.a,{exact:!0,path:"/",component:K}),r.a.createElement(O.a,{path:"/about",component:Y}),r.a.createElement(O.a,{path:"/create",component:V}),r.a.createElement(O.a,{path:"/login",component:ee})))}},{key:"upCredentialsFromLS",value:function(){var e=localStorage.getItem("credentials");e&&(e=JSON.parse(e)),e&&U.dispatch(B(e))}},{key:"componentWillMount",value:function(){var e=Object(l.a)(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.upCredentialsFromLS();case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),t}(a.Component),re=Object(o.b)(null,function(e){return{addAnecdotes:function(t){return e(H(t))}}})(ae);n(84);s.a.render(r.a.createElement(o.a,{store:U},r.a.createElement(re,null)),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.a511b046.chunk.js.map